<?xml version="1.0"?>
<!DOCTYPE module PUBLIC "-//Checkstyle//DTD Checkstyle Configuration 1.3//EN" "https://checkstyle.org/dtds/configuration_1_3.dtd">

<!--
    Checkstyle 配置文件 - 基于 Google Java Style 的现代化配置
    适配 Java 21 和 Spring Boot 3.x 项目
    参考: https://google.github.io/styleguide/javaguide.html
    版本: Checkstyle 10.21.0+
-->
<module name="Checker">
  <!-- 文件编码 -->
  <property name="charset" value="UTF-8" />
  <!-- 严重级别: error, warning, info, ignore -->
  <property name="severity" value="warning" />
  <!-- 检查的文件扩展名 -->
  <property name="fileExtensions" value="java, properties, xml" />
  <!-- 模块缓存文件（提升性能）-->
  <property name="cacheFile" value="${checkstyle.cache.file}" default="target/checkstyle-cachefile" />

  <!-- 抑制过滤器 -->
  <module name="SuppressionFilter">
    <property name="file" value="${basedir}/ops/tooling/checkstyle/suppressions.xml" />
    <property name="optional" value="true" />
  </module>

  <!-- 允许使用 @SuppressWarnings 注解抑制检查 -->
  <module name="SuppressWarningsFilter" />

  <!-- 允许使用 // CHECKSTYLE:OFF 和 // CHECKSTYLE:ON 注释抑制检查 -->
  <module name="SuppressWithPlainTextCommentFilter">
    <property name="offCommentFormat" value="CHECKSTYLE:OFF" />
    <property name="onCommentFormat" value="CHECKSTYLE:ON" />
  </module>

  <!-- ========== 文件级检查 ========== -->

  <!-- 禁止使用制表符 -->
  <module name="FileTabCharacter">
    <property name="eachLine" value="true" />
  </module>

  <!-- 文件长度限制 -->
  <module name="FileLength">
    <property name="max" value="2000" />
    <property name="severity" value="warning" />
  </module>

  <!-- 行尾不能有空格 -->
  <module name="RegexpSingleline">
    <property name="format" value="\s+$" />
    <property name="minimum" value="0" />
    <property name="maximum" value="0" />
    <property name="message" value="行尾存在空格" />
  </module>

  <!-- 行长度检查 - 与 Google Java Format 保持一致 -->
  <module name="LineLength">
    <property name="max" value="100" />
    <property name="ignorePattern"
      value="^package.*|^import.*|a href|href|http://|https://|ftp://|@see|@link|TODO|FIXME" />
  </module>

  <!-- 文件末尾必须有换行符 -->
  <module name="NewlineAtEndOfFile">
    <property name="lineSeparator" value="lf" />
  </module>

  <!-- 唯一属性检查（properties 文件）-->
  <module name="UniqueProperties">
    <property name="severity" value="error" />
  </module>

  <!-- ========== 树遍历检查 ========== -->
  <module name="TreeWalker">

    <!-- 使 @SuppressWarnings 注解生效 -->
    <module name="SuppressWarningsHolder" />

    <!-- ========== 注解检查 ========== -->

    <!-- 注解的位置 -->
    <module name="AnnotationLocation">
      <property name="allowSamelineMultipleAnnotations" value="false" />
      <property name="allowSamelineSingleParameterlessAnnotation" value="true" />
      <property name="allowSamelineParameterizedAnnotation" value="false" />
    </module>

    <!-- 注解使用风格 -->
    <module name="AnnotationUseStyle">
      <property name="elementStyle" value="compact_no_array" />
    </module>

    <!-- 禁止缺少 @Override 注解 -->
    <module name="MissingOverride" />

    <!-- ========== 命名约定 ========== -->

    <!-- 类名: UpperCamelCase -->
    <module name="TypeName">
      <property name="format" value="^[A-Z][a-zA-Z0-9]*$" />
      <message key="name.invalidPattern" value="类型名 ''{0}'' 必须匹配格式 ''{1}''（大驼峰命名）" />
    </module>

    <!-- 方法名: lowerCamelCase -->
    <module name="MethodName">
      <property name="format" value="^[a-z][a-zA-Z0-9]*$" />
      <message key="name.invalidPattern" value="方法名 ''{0}'' 必须匹配格式 ''{1}''（小驼峰命名）" />
    </module>

    <!-- 成员变量名: lowerCamelCase -->
    <module name="MemberName">
      <property name="format" value="^[a-z][a-zA-Z0-9]*$" />
      <message key="name.invalidPattern" value="成员变量名 ''{0}'' 必须匹配格式 ''{1}''（小驼峰命名）" />
    </module>

    <!-- 常量名: UPPER_CASE_WITH_UNDERSCORES -->
    <module name="ConstantName">
      <property name="format" value="^log(ger)?$|^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$" />
    </module>

    <!-- 局部变量名 -->
    <module name="LocalVariableName">
      <property name="format" value="^[a-z]([a-zA-Z0-9]*)?$" />
      <message key="name.invalidPattern" value="局部变量名 ''{0}'' 必须匹配格式 ''{1}''" />
    </module>

    <!-- 参数名 -->
    <module name="ParameterName">
      <property name="format" value="^[a-z]([a-zA-Z0-9]*)?$" />
      <message key="name.invalidPattern" value="参数名 ''{0}'' 必须匹配格式 ''{1}''" />
    </module>

    <!-- 包名 -->
    <module name="PackageName">
      <property name="format" value="^[a-z]+(\.[a-z][a-z0-9]*)*$" />
      <message key="name.invalidPattern" value="包名 ''{0}'' 必须匹配格式 ''{1}''（全小写）" />
    </module>

    <!-- Lambda 参数名 -->
    <module name="LambdaParameterName">
      <property name="format" value="^[a-z]([a-zA-Z0-9]*)?$|^_$" />
      <message key="name.invalidPattern" value="Lambda 参数名 ''{0}'' 必须匹配格式 ''{1}''" />
    </module>

    <!-- Record 组件名（Java 21）-->
    <module name="RecordComponentName">
      <property name="format" value="^[a-z]([a-zA-Z0-9]*)?$" />
    </module>

    <!-- 模式变量名（Java 21 Pattern Matching）-->
    <module name="PatternVariableName">
      <property name="format" value="^[a-z]([a-zA-Z0-9]*)?$" />
    </module>

    <!-- 类型参数名（泛型）-->
    <module name="ClassTypeParameterName">
      <property name="format" value="^[A-Z]([A-Z0-9]*)?$" />
    </module>
    <module name="MethodTypeParameterName">
      <property name="format" value="^[A-Z]([A-Z0-9]*)?$" />
    </module>
    <module name="InterfaceTypeParameterName">
      <property name="format" value="^[A-Z]([A-Z0-9]*)?$" />
    </module>

    <!-- ========== 导入检查 ========== -->

    <!-- 禁止星号导入 -->
    <module name="AvoidStarImport">
      <property name="severity" value="warning" />
      <!-- 允许静态导入使用星号 -->
      <property name="allowStaticMemberImports" value="true" />
    </module>

    <!-- 禁止未使用的导入 -->
    <module name="UnusedImports" />

    <!-- 禁止冗余导入 -->
    <module name="RedundantImport" />

    <!-- 禁止非法导入（如 sun.* 包）-->
    <module name="IllegalImport">
      <property name="illegalPkgs" value="sun, com.sun" />
    </module>

    <!-- 导入顺序 - 与 Spotless/Google Java Format 保持一致 -->
    <!-- 由于 Google Java Format 自动处理导入顺序，此处禁用以避免冲突 -->
    <!-- 如需自定义导入顺序，请使用 Spotless 的 importOrder 配置 -->
    <!--
    <module name="CustomImportOrder">
      <property name="sortImportsInGroupAlphabetically" value="true" />
      <property name="separateLineBetweenGroups" value="true" />
      <property name="customImportOrderRules"
        value="STATIC###STANDARD_JAVA_PACKAGE###THIRD_PARTY_PACKAGE###SPECIAL_IMPORTS" />
      <property name="specialImportsRegExp" value="^com\.zhangzhankui\." />
    </module>
    -->

    <!-- ========== 代码块检查 ========== -->

    <!-- 左大括号的位置 -->
    <module name="LeftCurly">
      <property name="option" value="eol" />
    </module>

    <!-- 右大括号的位置 -->
    <module name="RightCurly">
      <property name="option" value="same" />
      <property name="tokens"
        value="LITERAL_TRY, LITERAL_CATCH, LITERAL_FINALLY, LITERAL_IF, LITERAL_ELSE, LITERAL_DO" />
    </module>

    <!-- 需要大括号 -->
    <module name="NeedBraces">
      <property name="allowSingleLineStatement" value="true" />
    </module>

    <!-- 空代码块 -->
    <module name="EmptyBlock">
      <property name="option" value="TEXT" />
      <property name="tokens"
        value="LITERAL_TRY, LITERAL_FINALLY, LITERAL_IF, LITERAL_ELSE, LITERAL_SWITCH" />
    </module>

    <!-- ========== 空白检查 ========== -->

    <!-- 空行分隔 -->
    <module name="EmptyLineSeparator">
      <property name="allowNoEmptyLineBetweenFields" value="true" />
      <property name="allowMultipleEmptyLines" value="false" />
      <property name="allowMultipleEmptyLinesInsideClassMembers" value="false" />
    </module>

    <!-- 泛型空格 -->
    <module name="GenericWhitespace">
      <message key="ws.followed" value="GenericWhitespace ''{0}'' 后面不应有空格" />
      <message key="ws.preceded" value="GenericWhitespace ''{0}'' 前面不应有空格" />
      <message key="ws.illegalFollow" value="GenericWhitespace ''{0}'' 后面应有空格" />
      <message key="ws.notPreceded" value="GenericWhitespace ''{0}'' 前面应有空格" />
    </module>

    <!-- 方法参数不能有空格 -->
    <module name="MethodParamPad" />

    <!-- 类型转换后不应有空格 -->
    <module name="NoWhitespaceAfter" />

    <!-- 操作符前不应有空格 -->
    <module name="NoWhitespaceBefore" />

    <!-- 操作符换行 - 由 Spotless/Google Java Format 统一管理，禁用此检查 -->
    <!--
    <module name="OperatorWrap">
      <property name="option" value="EOL" />
      <property name="tokens"
        value="BAND, BOR, BSR, BXOR, DIV, EQUAL, GE, GT, LAND, LE, LITERAL_INSTANCEOF, LOR, LT, MINUS, MOD, NOT_EQUAL, PLUS, QUESTION, SL, SR, STAR, METHOD_REF" />
    </module>
    -->

    <!-- 空白符周围检查 -->
    <module name="WhitespaceAround">
      <property name="allowEmptyConstructors" value="true" />
      <property name="allowEmptyMethods" value="true" />
      <property name="allowEmptyTypes" value="true" />
      <property name="allowEmptyLoops" value="true" />
      <property name="allowEmptyLambdas" value="true" />
      <property name="allowEmptyCatches" value="true" />
    </module>

    <!-- ========== 代码复杂度检查 ========== -->

    <!-- 方法长度 -->
    <module name="MethodLength">
      <property name="max" value="150" />
      <property name="countEmpty" value="false" />
    </module>

    <!-- 参数数量 -->
    <module name="ParameterNumber">
      <property name="max" value="8" />
      <property name="ignoreOverriddenMethods" value="true" />
    </module>

    <!-- 圈复杂度 -->
    <module name="CyclomaticComplexity">
      <property name="max" value="20" />
      <property name="severity" value="warning" />
    </module>

    <!-- 布尔表达式复杂度 -->
    <module name="BooleanExpressionComplexity">
      <property name="max" value="5" />
    </module>

    <!-- 嵌套 if 深度 -->
    <module name="NestedIfDepth">
      <property name="max" value="4" />
    </module>

    <!-- 嵌套 try 深度 -->
    <module name="NestedTryDepth">
      <property name="max" value="2" />
    </module>

    <!-- ========== 编码问题检查 ========== -->

    <!-- 避免嵌套块 -->
    <module name="AvoidNestedBlocks" />

    <!-- 空语句 -->
    <module name="EmptyStatement" />

    <!-- equals 和 hashCode 必须一起覆盖 -->
    <module name="EqualsHashCode" />

    <!-- 隐藏字段 -->
    <module name="HiddenField">
      <property name="ignoreSetter" value="true" />
      <property name="ignoreConstructorParameter" value="true" />
    </module>

    <!-- 简化布尔表达式 -->
    <module name="SimplifyBooleanExpression" />

    <!-- 简化布尔返回 -->
    <module name="SimplifyBooleanReturn" />

    <!-- String.equals 常量放前面 -->
    <module name="EqualsAvoidNull" />

    <!-- 避免内联条件表达式 -->
    <module name="AvoidInlineConditionals">
      <property name="severity" value="ignore" />
    </module>

    <!-- switch 语句必须有 default -->
    <module name="MissingSwitchDefault" />

    <!-- fall-through 注释 -->
    <module name="FallThrough" />

    <!-- 一行一个声明 -->
    <module name="MultipleVariableDeclarations" />

    <!-- 数组风格: String[] args 而不是 String args[] -->
    <module name="ArrayTypeStyle" />

    <!-- UpperEll: 使用 L 而不是 l 表示 long -->
    <module name="UpperEll" />

    <!-- 禁止使用 finalize 方法 -->
    <module name="NoFinalizer" />

    <!-- 禁止克隆方法 -->
    <module name="NoClone" />

    <!-- 避免双花括号初始化 -->
    <module name="AvoidDoubleBraceInitialization" />

    <!-- 不必要的分号 -->
    <module name="UnnecessarySemicolonInTryWithResources" />
    <module name="UnnecessarySemicolonAfterTypeMemberDeclaration" />
    <module name="UnnecessarySemicolonInEnumeration" />

    <!-- ========== 修饰符检查 ========== -->

    <!-- 修饰符顺序 -->
    <module name="ModifierOrder" />

    <!-- 冗余修饰符 -->
    <module name="RedundantModifier" />

    <!-- ========== Java 21 特性支持 ========== -->

    <!-- Pattern matching for switch -->
    <!-- Record 模式支持 -->
    <!-- 允许 sealed 类 -->
    <!-- 允许 text blocks -->

    <!-- ========== 其他检查 ========== -->

    <!-- 禁止使用空文件 -->
    <module name="OuterTypeNumber">
      <property name="max" value="1" />
    </module>

    <!-- 检查文件中是否有多个顶级类 -->
    <module name="OneTopLevelClass" />

    <!-- 检查顶级类是否与文件名匹配 -->
    <module name="OuterTypeFilename" />

    <!-- 检查是否使用 this 关键字 -->
    <module name="RequireThis">
      <property name="checkFields" value="false" />
      <property name="checkMethods" value="false" />
    </module>

  </module>

</module>
